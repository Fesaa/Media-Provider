<div class="pt-1 md:pt-5 mx-16">

  <app-table
    [items]="subscriptions"
    [trackByIdFunc]="trackBy"
    *transloco="let t;prefix:'subscriptions'"
  >

    <ng-template #header>
      <tr>
        <th>{{ t('title') }}</th>
        <th>{{t('next-exec')}}</th>
        <th>{{ t('last') }}</th>
        <th>{{ t('frequency') }}</th>
        <th>
          <div class="flex flex-row space-x-2 justify-center items-center">
            <span>{{ t('actions.label') }}</span>
            <button class="btn btn-secondary" (click)="runAll()" [disabled]="hasRanAll()">
              {{ t('actions.run-all') }}
            </button>
          </div>
        </th>
      </tr>
    </ng-template>

    <ng-template #cell let-sub>
      <th>
        <a href="{{sub.contentId | subscriptionExternalUrl:sub.provider}}" target="_blank" rel="noopener noreferrer">
          {{ sub.info.title }}
        </a>
      </th>
      <th>{{sub.info.nextExecution | utcToLocalTime:'short'}}</th>
      <th>

        <app-badge [colour]="sub.info.lastCheckSuccess ? 'primary' : 'error'"
                   [pTooltip]="(sub.info.lastCheck | date:'yyyy-MM-dd HH:mm:ss') ?? t('unknown')"
                   tooltipPosition="top"
        >
          {{sub.info.lastCheckSuccess ? t('success') : t('failing')}}
        </app-badge>
      </th>
      <th>
        <app-badge [colour]="getSeverity(sub)">
          {{sub.refreshFrequency | refreshFrequency}}
        </app-badge>
      </th>
      <th>
        <div class="flex flex-col md:flex-row space-y-5 md:space-y-0 md:space-x-5 my-2">

          <app-subscription-edit-dialog (update)="update($event)" [sub]="sub" [providers]="allowedProviders" [(visible)]="displayEditSubscription[sub.ID]" />

          <button class="btn btn-primary btn-small" (click)="edit(sub)"
            [pTooltip]="t('actions.edit')"
            tooltipPosition="bottom"
          >
            <span class="pi pi-pencil"></span>
          </button>

          <button class="btn btn-success btn-small" (click)="runOnce(sub)"
            [pTooltip]="t('actions.run-once')"
            tooltipPosition="bottom"
          >
            <span class="pi pi-download"></span>
          </button>

          <button class="btn btn-error btn-small" (click)="delete(sub)"
            [pTooltip]="t('actions.delete')"
            tooltipPosition="bottom"
          >
            <span class="pi pi-trash"></span>
          </button>

        </div>
      </th>
    </ng-template>

  </app-table>
</div>
