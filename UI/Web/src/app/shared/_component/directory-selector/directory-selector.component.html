<ng-container *transloco="let t;prefix:'directory-selector'">
  <div class="modal-container">
    <div class="modal-header">
      <h1 class="modal-title fs-5" id="directorySelectModalLabel">
        {{ t('selected') }} <span class="font-monospace">{{ routeStack.items.join('/') }}</span>
      </h1>
      <button type="button" class="btn-close" (click)="closeModal()"></button>
    </div>

    <div class="modal-body">
      @if (filter) {
        <div class="mb-3">
          <input
            class="form-control form-control-sm"
            type="text"
            [placeholder]="t('filter')"
            (input)="onFilterChange($event)"
          />
        </div>
      }

      <div class="d-flex flex-column mb-3" style="max-height: 20rem; overflow-y: auto;">
        @if (currentRoot !== root) {
          <div class="directory-item d-flex align-items-center p-2 mb-2 bg-light border rounded">
            <i class="fa fa-folder me-2 text-secondary"></i>
            <span
              class="flex-grow-1 text-start text-decoration-none directory-nav-item"
              role="button"
              tabindex="0"
              (click)="goBack()"
              (keydown.enter)="goBack()"
            >{{ t('dots') }}</span>
          </div>
        }

        <div class="d-flex flex-column" style="min-height: 15rem;">
          @if (getEntries().length > 0) {
            @for (entry of getEntries(); track $index) {
              <div class="directory-item d-flex align-items-center p-2 mb-2 bg-light border rounded">
                <i [class]="entry.dir ? 'fa fa-folder me-2 text-primary' : 'fa fa-file me-2 text-secondary'"></i>
                <span
                  class="flex-grow-1 fw-semibold text-start"
                  [class]="entry.dir ? 'directory-nav-item' : ''"
                  [attr.role]="entry.dir ? 'button' : null"
                  [attr.tabindex]="entry.dir ? '0' : null"
                  (click)="selectNode(entry)"
                  [attr.aria-label]="entry.dir ? 'Navigate to ' + entry.name : entry.name"
                  (keydown.enter)="entry.dir && selectNode(entry)"
                >{{ entry.name }}</span>

                @if (copy) {
                  <i
                    class="pi pi-clipboard text-muted copy-btn"
                    role="button"
                    tabindex="0"
                    [attr.aria-label]="'Copy path for ' + entry.name"
                    (click)="copyPath(entry)"
                    (keydown.enter)="copyPath(entry)"
                  ></i>
                }
              </div>
            }
          } @else {
            <div class="d-flex align-items-center justify-content-center h-100 text-muted">
              <div class="text-center">
                <i class="fa fa-folder-open fa-2x mb-2 opacity-50"></i>
                <p class="mb-0 small">No items found</p>
              </div>
            </div>
          }
        </div>
      </div>

      @if (create) {
        <div class="d-flex align-items-center gap-2">
          <input
            class="form-control form-control-sm flex-grow-1"
            type="text"
            [placeholder]="t('create')"
            [(ngModel)]="newDirName"
            (input)="onNewDirNameChange($event)"
            (keydown.enter)="createNew()"
          />
          <button
            type="button"
            class="btn btn-outline-primary btn-sm px-3"
            (click)="createNew()"
            [disabled]="!newDirName.trim()"
            [attr.aria-label]="'Create new directory: ' + newDirName"
          >
            <i class="fa fa-plus"></i>
          </button>
        </div>
      }
    </div>

    <div class="modal-footer">
      <button
        type="button"
        class="btn btn-secondary"
        data-bs-dismiss="modal"
        (click)="closeModal()"
      >
        {{t('cancel') | titlecase}}
      </button>
      <button
        type="button"
        class="btn btn-primary"
        (click)="confirm()"
      >
        {{t('confirm') | titlecase}}
      </button>
    </div>

  </div>
</ng-container>
