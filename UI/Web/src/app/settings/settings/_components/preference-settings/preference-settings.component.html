<div class="d-flex w-100 flex-grow-1 flex-column" *transloco="let t; prefix: 'settings.preferences'">
  @let pref = preferences();
  @if (preferencesForm && pref) {
    <form class="d-flex flex-column flex-grow-1 gap-3 gap-md-4" [formGroup]="preferencesForm">

      <div class="mb-3">
        @if (preferencesForm.get('subscriptionRefreshHour'); as control) {
          <app-settings-item [control]="control" [title]="t('sub-refresh.label')">
            <ng-template #view>{{control.value}}</ng-template>
            <ng-template #edit>
              <input
                type="number"
                class="form-control"
                id="subscriptionRefreshHour"
                formControlName="subscriptionRefreshHour"
                [min]="0"
                [max]="23"
              />
            </ng-template>
          </app-settings-item>
        }
      </div>

      <div class="form-check form-switch mb-3">
        <input
          type="checkbox"
          class="form-check-input"
          id="logEmptyDownloads"
          formControlName="logEmptyDownloads"
        />
        <label class="form-check-label" for="logEmptyDownloads">
          {{ t('empty-download-notification') }}
        </label>
      </div>

      <div class="form-check form-switch mb-3">
        <input
          type="checkbox"
          class="form-check-input"
          id="convertToWebp"
          formControlName="convertToWebp"
        />
        <label class="form-check-label" for="convertToWebp">
          {{ t('convertToWebp') }}
        </label>
      </div>

      <div class="mb-3">
        <label for="coverFallbackMethod" class="form-label">
          {{ t('cover-fallback-method') }}
        </label>
        <select
          class="form-select"
          id="coverFallbackMethod"
          formControlName="coverFallbackMethod"
        >
          @for (opt of CoverFallbackMethods; track opt.value) {
            <option [value]="opt.value">{{ opt.label }}</option>
          }
        </select>
      </div>

      <div class="mb-3">
        @if (preferencesForm.get('blackList'); as formControl) {
          <app-settings-item
            [control]="formControl"
            [title]="t('tags-blacklist-label')"
            [tooltip]="t('tags-blacklist-tooltip')"
          >
            <ng-template #view>
              @let val = breakString(formControl.value);
              @for (opt of val; track opt) {
                <app-tag-badge>{{ opt.trim() }}</app-tag-badge>
              } @empty {
                -
              }
            </ng-template>

            <ng-template #edit>
              <textarea
                rows="3"
                id="blacklist"
                class="form-control"
                formControlName="blackList"
              ></textarea>
            </ng-template>
          </app-settings-item>
        }
      </div>

      <div class="mb-3">
        @if (preferencesForm.get('whiteList'); as formControl) {
          <app-settings-item
            [control]="formControl"
            [title]="t('tags-whitelist-label')"
            [tooltip]="t('tags-whitelist-tooltip')"
          >
            <ng-template #view>
              @let val = breakString(formControl.value);
              @for (opt of val; track opt) {
                <app-tag-badge>{{ opt.trim() }}</app-tag-badge>
              } @empty {
                -
              }
            </ng-template>

            <ng-template #edit>
              <textarea
                rows="3"
                id="whiteList"
                class="form-control"
                formControlName="whiteList"
              ></textarea>
            </ng-template>
          </app-settings-item>
        }
      </div>

      <div class="mb-3">
        @if (preferencesForm.get('tagToGenre'); as formControl) {
          <app-settings-item
            [control]="formControl"
            [title]="t('tags-to-genre-label')"
            [tooltip]="t('tags-to-genre-tooltip')"
          >
            <ng-template #view>
              @let val = breakString(formControl.value);
              @for (opt of val; track opt) {
                <app-tag-badge>{{ opt.trim() }}</app-tag-badge>
              } @empty {
                -
              }
            </ng-template>

            <ng-template #edit>
              <textarea
                rows="3"
                id="tagToGenre"
                class="form-control"
                formControlName="tagToGenre"
              ></textarea>
            </ng-template>
          </app-settings-item>
        }
      </div>

      <div class="mb-3 d-flex align-items-center justify-content-between">
        <label class="form-label mb-0">{{ t('age-rating-mappings.label') }}</label>
        <button class="btn btn-secondary">
          {{ t('configure') }}
        </button>
      </div>

      <div class="mb-3 d-flex align-items-center justify-content-between">
        <label class="form-label mb-0">{{ t('tags-mappings.label') }}</label>
        <button class="btn btn-secondary">
          {{ t('configure') }}
        </button>
      </div>

    </form>
  }
</div>
