<div class="flex w-full flex-grow" *transloco="let t;prefix:'settings.server'">
  @if (settingsForm !== undefined && config() !== undefined) {
    <form [formGroup]="settingsForm" class="w-full px-2" (ngSubmit)="save()">
      <div class="flex flex-col items-center space-y-4 md:space-y-0">

        <div class="w-full">
          <h2 class="text-2xl font-bold mt-4 mb-4">
            {{ t('general') }}
          </h2>

          <div class="flex flex-col space-y-5">
            @if (getFormControl('rootDir'); as rootDir) {
              <app-form-input [control]="rootDir" [title]="t('root-dir')"></app-form-input>
            }

            @if (getFormControl('baseUrl'); as baseUrl) {
              <app-form-input [control]="baseUrl" [title]="t('base-url')"></app-form-input>
            }

            @if (getFormControl('cacheType'); as cacheType) {
              <app-form-select [title]="t('cache.label')" [subTitle]="t('cache.subTitle')" [control]="cacheType">
                <ng-template #options>
                  @for (ct of CacheTypes; track ct.key) {
                    <option [value]="ct.value">{{t('cache.'+ct.key)}}</option>
                  }
                </ng-template>
              </app-form-select>
            }

            @switch (settingsForm.value.cacheType) {
              @case (CacheType.REDIS) {
                @if (getFormControl('redisAddr'); as redisAddr) {
                  <app-form-input
                    [control]="redisAddr"
                    [title]="t('redis-address')"
                    type="text"
                  />
                }
              }
            }
          </div>
        </div>

        <div class="w-full">
          <div class="border-t border-black dark:border-white mt-10"></div>
          <h2 class="text-2xl font-bold mt-4 mb-4">
            {{ t('downloader') }}
          </h2>

          <div class="flex flex-col space-y-5">
            @if (getFormControl('maxConcurrentTorrents'); as maxTorrents) {
              <app-form-input [control]="maxTorrents" [title]="t('max-torrents.label')" [subTitle]="t('max-torrents.subTitle')" type="number"/>
            }

            @if (getFormControl('maxConcurrentImages'); as maxImages) {
              <app-form-input [control]="maxImages" [title]="t('max-images.label')" [subTitle]="t('max-images.subTitle')" type="number"/>
            }
          </div>
        </div>

        <div class="w-full">
          <div class="border-t border-black dark:border-white mt-10"></div>
          <h2 class="text-2xl font-bold mt-4 mb-4">
            {{ t('oidc.title') }}
          </h2>

          <div class="flex flex-col space-y-5">
            @if (getFormControl('oidc.authority'); as authority) {
              <app-form-input [control]="authority" [title]="t('oidc.authority.label')" [subTitle]="t('oidc.authority.subTitle')" />
            }

            @if (getFormControl('oidc.clientId'); as clientId) {
              <app-form-input [control]="clientId" [title]="t('oidc.clientId.label')" [subTitle]="t('oidc.clientId.subTitle')" />
            }

            <div class="flex flex-row w-full justify-around">
              @if (getFormControl('oidc.autoLogin'); as autoLogin) {
                <app-form-input [control]="autoLogin" [title]="t('oidc.autoLogin.label')" type="switch" [subTitle]="t('oidc.autoLogin.subTitle')" />
              }

              @if (getFormControl('oidc.disablePasswordLogin'); as disablePasswordLogin) {
                <app-form-input [control]="disablePasswordLogin" [title]="t('oidc.disablePasswordLogin.label')" type="switch" [subTitle]="t('oidc.disablePasswordLogin.subTitle')" />
              }
            </div>
          </div>
        </div>

        <div class="flex w-full justify-center md:justify-end mt-10">
          <p-button type="submit" severity="primary">{{ t('save') }}</p-button>
        </div>
      </div>
    </form>
  }
</div>
